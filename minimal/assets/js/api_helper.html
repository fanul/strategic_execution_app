<script>
// API Helper with Debug Logging
console.log('[INIT] api_helper.html loaded');

// Note: Global variables (directoratesTable, workUnitsTable, affairsTable, positionsTable, loadingTimeout, DEBUG_MODE)
// are declared in debug_panel_script.html to avoid duplicate declarations
function apiCall(endpoint, data = {}) {
    debugLog('API', '-> CALL START: ' + endpoint, data);

    return new Promise((resolve, reject) => {
        const startTime = Date.now();

        google.script.run
            .withSuccessHandler(result => {
                const duration = Date.now() - startTime;
                debugLog('API', 'OK CALL SUCCESS: ' + endpoint + ' (' + duration + 'ms)', result);
                resolve(result);
            })
            .withFailureHandler(error => {
                const duration = Date.now() - startTime;
                debugLog('API', 'FAIL CALL ERROR: ' + endpoint + ' (' + duration + 'ms)', error);
                resolve({
                    success: false,
                    message: error.toString(),
                    error: error.toString()
                });
            })
            .callAPI(endpoint, data || {});
    });
}

debugLog('INIT', 'apiCall function defined');

// Track script loading
if (window.scriptLoadTracker) {
    window.scriptLoadTracker.loaded('api_helper.html');
}
</script>
