<!-- Audit Trail Page -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Audit Trail</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="AuditManager.exportAuditTrail()">
            <i class="bi bi-download"></i> Export
        </button>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-2">
                <label class="form-label">Entity Type</label>
                <select class="form-select" id="auditEntityTypeFilter">
                    <option value="">All Types</option>
                    <option value="user">User</option>
                    <option value="role">Role</option>
                    <option value="kpi">KPI</option>
                    <option value="okr">OKR</option>
                    <option value="goal">Goal</option>
                    <option value="program">Program</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Change Type</label>
                <select class="form-select" id="auditChangeTypeFilter">
                    <option value="">All Changes</option>
                    <option value="CREATE">Create</option>
                    <option value="UPDATE">Update</option>
                    <option value="DELETE">Delete</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">User</label>
                <select class="form-select" id="auditUserFilter">
                    <option value="">All Users</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" id="auditDateFilter">
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-primary w-100" onclick="AuditManager.loadAuditTrail()">
                    <i class="bi bi-search"></i> Search
                </button>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-outline-secondary w-100" onclick="clearAuditFilters()">
                    <i class="bi bi-x-circle"></i> Clear
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Audit Trail Table -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover table-sm">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Entity Type</th>
                        <th>Entity ID</th>
                        <th>Field</th>
                        <th>Change Type</th>
                        <th>User</th>
                        <th>Old Value</th>
                        <th>New Value</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="auditTrailBody">
                    <tr><td colspan="9" class="text-center text-muted">Loading audit trail...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
<nav aria-label="Audit Trail Pagination" class="mt-3">
    <ul class="pagination justify-content-center" id="auditPagination">
        <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
    </ul>
</nav>

<!-- Page Modals -->
<div id="page-modals">
    <!-- Entity History Modal -->
    <div class="modal fade" id="entityHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Entity History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="entityHistoryContent">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function clearAuditFilters() {
    document.getElementById('auditEntityTypeFilter').value = '';
    document.getElementById('auditChangeTypeFilter').value = '';
    document.getElementById('auditUserFilter').value = '';
    document.getElementById('auditDateFilter').value = '';
    AuditManager.loadAuditTrail();
}

// Initialize audit trail page
document.addEventListener('DOMContentLoaded', function() {
    if (typeof AuditManager !== 'undefined' && AuditManager.init) {
        AuditManager.init();
    }
});
</script>
