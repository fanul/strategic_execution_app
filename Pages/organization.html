<!-- Organization Management Page -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Organization Management</h1>
    <div class="btn-toolbar mb-2 mb-md-0" id="org-page-header" style="display: flex;">
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="showOrgDiagram()">
            <i class="bi bi-diagram-3"></i> Organization Diagram
        </button>
    </div>
</div>

<!-- Table View -->
<div id="table-view" class="view-section active">
<!-- Organization View -->
<div id="organization-view" class="view-section active">
    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs mb-4" id="orgTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="org-units-tab" data-bs-toggle="tab" data-bs-target="#org-units" type="button" role="tab">
                <i class="bi bi-diagram-3 me-2"></i>Organizational Units
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="directorates-tab" data-bs-toggle="tab" data-bs-target="#directorates" type="button" role="tab">
                <i class="bi bi-building me-2"></i>Directorates (Legacy)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="work-units-tab" data-bs-toggle="tab" data-bs-target="#work-units" type="button" role="tab">
                <i class="bi bi-layers me-2"></i>Work Units (Legacy)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="affairs-tab" data-bs-toggle="tab" data-bs-target="#affairs" type="button" role="tab">
                <i class="bi bi-folder me-2"></i>Affairs (Legacy)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="positions-tab" data-bs-toggle="tab" data-bs-target="#positions" type="button" role="tab">
                <i class="bi bi-person-badge me-2"></i>Positions
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="orgTabContent">
        <!-- Organizational Units Tab (NEW - BPJS Structure) -->
        <div class="tab-pane fade show active" id="org-units" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">BPJS Ketenagakerjaan - Organizational Structure</h5>
                <div>
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="showViewModeSelector()">
                        <i class="bi bi-list-check"></i> View Mode
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showModal('org-unit')">
                        <i class="bi bi-plus-lg me-1"></i>Add Organizational Unit
                    </button>
                </div>
            </div>

            <!-- Quick Stats Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card border-primary">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2 text-muted">Total Units</h6>
                            <h3 class="card-title text-primary" id="stat-total-units">-</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-success">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2 text-muted">Regional Offices</h6>
                            <h3 class="card-title text-success" id="stat-regional-offices">-</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-info">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2 text-muted">Branch Offices</h6>
                            <h3 class="card-title text-info" id="stat-branch-offices">-</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-warning">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2 text-muted">Subsidiaries</h6>
                            <h3 class="card-title text-warning" id="stat-subsidiaries">-</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Filter Panel -->
            <div class="accordion mb-3" id="org-units-filter-accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#org-units-filter-collapse">
                            <i class="bi bi-funnel-fill me-2"></i> Advanced Filters
                        </button>
                    </h2>
                    <div id="org-units-filter-collapse" class="accordion-collapse collapse show"
                         data-bs-parent="#org-units-filter-accordion">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Unit Type</label>
                                    <select class="form-select" id="org-units-filter-type" multiple>
                                        <option value="ROOT">ROOT (Organization)</option>
                                        <option value="DIRECTORATE">Directorate (HQ)</option>
                                        <option value="WORK_UNIT">Work Unit (HQ)</option>
                                        <option value="AFFAIR">Affair (HQ)</option>
                                        <option value="REGIONAL_OFFICE">Regional Office</option>
                                        <option value="BRANCH_OFFICE">Branch Office</option>
                                        <option value="SUBSIDIARY">Subsidiary</option>
                                        <option value="SUBSIDIARY_UNIT">Subsidiary Unit</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Classification</label>
                                    <select class="form-select" id="org-units-filter-classification" multiple>
                                        <option value="HQ">Headquarters (HQ)</option>
                                        <option value="KELAS_1">Kelas 1 (Branch)</option>
                                        <option value="KELAS_2">Kelas 2 (Branch)</option>
                                        <option value="KELAS_3">Kelas 3 (Branch)</option>
                                        <option value="KELAS_3A">Kelas 3A (Branch)</option>
                                        <option value="SUBSIDIARY">Subsidiary</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Province</label>
                                    <input type="text" class="form-control" id="org-units-filter-province"
                                           placeholder="Filter by province...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" id="org-units-filter-city"
                                           placeholder="Filter by city...">
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="org-units-show-inactive">
                                        <label class="form-check-label" for="org-units-show-inactive">
                                            Show inactive/closed units
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary btn-sm w-100" onclick="OrgUnitManager.applyFilters()">
                                        <i class="bi bi-filter"></i> Apply Filters
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-secondary btn-sm w-100" onclick="OrgUnitManager.clearFilters()">
                                        <i class="bi bi-x-circle"></i> Clear Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hierarchy Tree Toggle -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-primary active" id="btn-tree-view" onclick="OrgUnitManager.showTreeView()">
                        <i class="bi bi-diagram-3"></i> Tree View
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="btn-flat-view" onclick="OrgUnitManager.showFlatView()">
                        <i class="bi bi-list-ul"></i> Flat View
                    </button>
                </div>
                <div>
                    <button class="btn btn-outline-success btn-sm" onclick="OrgDiagram.expandAll()">
                        <i class="bi bi-arrows-expand"></i> Expand All
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="OrgDiagram.collapseAll()">
                        <i class="bi bi-arrows-collapse"></i> Collapse All
                    </button>
                </div>
            </div>

            <!-- Tree View Container -->
            <div id="org-units-tree-view">
                <div class="card">
                    <div class="card-body">
                        <div id="org-units-tree-container" style="min-height: 500px; padding: 20px;">
                            <div class="text-center text-muted">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading organizational structure...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flat View Container (Table) -->
            <div id="org-units-flat-view" style="display: none;">
                <div class="table-responsive">
                    <table class="table table-hover" id="org-units-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Level</th>
                                <th>Classification</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="org-units-body">
                            <tr><td colspan="8" class="text-center text-muted">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Directorates Tab -->
        <div class="tab-pane fade" id="directorates" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Directorates</h5>
                <button class="btn btn-primary btn-sm" onclick="showModal('directorate')">
                    <i class="bi bi-plus-lg me-1"></i>Add Directorate
                </button>
            </div>

            <!-- Filter Panel -->
            <div class="accordion mb-3" id="directorates-filter-accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#directorates-filter-collapse">
                            <i class="bi bi-funnel me-2"></i> Filters
                        </button>
                    </h2>
                    <div id="directorates-filter-collapse" class="accordion-collapse collapse"
                         data-bs-parent="#directorates-filter-accordion">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Code</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="0" id="directorates-filter-code"
                                           placeholder="Filter by code...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="1" id="directorates-filter-name"
                                           placeholder="Filter by name...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Description</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="2" id="directorates-filter-description"
                                           placeholder="Filter by description...">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button class="btn btn-secondary btn-sm" onclick="OrganizationManager.clearFilters('directorates')">
                                        <i class="bi bi-x-circle"></i> Clear Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-hover" id="directorates-table">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="directorates-body">
                        <tr><td colspan="4" class="text-center text-muted">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Work Units Tab -->
        <div class="tab-pane fade" id="work-units" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Work Units</h5>
                <button class="btn btn-primary btn-sm" onclick="showModal('work-unit')">
                    <i class="bi bi-plus-lg me-1"></i>Add Work Unit
                </button>
            </div>

            <!-- Filter Panel -->
            <div class="accordion mb-3" id="work-units-filter-accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#work-units-filter-collapse">
                            <i class="bi bi-funnel me-2"></i> Filters
                        </button>
                    </h2>
                    <div id="work-units-filter-collapse" class="accordion-collapse collapse"
                         data-bs-parent="#work-units-filter-accordion">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Code</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="0" id="work-units-filter-code"
                                           placeholder="Filter by code...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="1" id="work-units-filter-name"
                                           placeholder="Filter by name...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Directorate</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="2" id="work-units-filter-directorate"
                                           placeholder="Filter by directorate...">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button class="btn btn-secondary btn-sm" onclick="OrganizationManager.clearFilters('work-units')">
                                        <i class="bi bi-x-circle"></i> Clear Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-hover" id="work-units-table">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Directorate</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="work-units-body">
                        <tr><td colspan="4" class="text-center text-muted">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Affairs Tab -->
        <div class="tab-pane fade" id="affairs" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Affairs</h5>
                <button class="btn btn-primary btn-sm" onclick="showModal('affair')">
                    <i class="bi bi-plus-lg me-1"></i>Add Affair
                </button>
            </div>

            <!-- Filter Panel -->
            <div class="accordion mb-3" id="affairs-filter-accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#affairs-filter-collapse">
                            <i class="bi bi-funnel me-2"></i> Filters
                        </button>
                    </h2>
                    <div id="affairs-filter-collapse" class="accordion-collapse collapse"
                         data-bs-parent="#affairs-filter-accordion">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Code</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="0" id="affairs-filter-code"
                                           placeholder="Filter by code...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="1" id="affairs-filter-name"
                                           placeholder="Filter by name...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Work Unit</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="2" id="affairs-filter-workunit"
                                           placeholder="Filter by work unit...">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button class="btn btn-secondary btn-sm" onclick="OrganizationManager.clearFilters('affairs')">
                                        <i class="bi bi-x-circle"></i> Clear Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-hover" id="affairs-table">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Work Unit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="affairs-body">
                        <tr><td colspan="4" class="text-center text-muted">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Positions Tab -->
        <div class="tab-pane fade" id="positions" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Positions</h5>
                <button class="btn btn-primary btn-sm" onclick="showModal('position')">
                    <i class="bi bi-plus-lg me-1"></i>Add Position
                </button>
            </div>

            <!-- Filter Panel -->
            <div class="accordion mb-3" id="positions-filter-accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#positions-filter-collapse">
                            <i class="bi bi-funnel me-2"></i> Filters
                        </button>
                    </h2>
                    <div id="positions-filter-collapse" class="accordion-collapse collapse"
                         data-bs-parent="#positions-filter-accordion">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Code</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="0" id="positions-filter-code"
                                           placeholder="Filter by code...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="1" id="positions-filter-name"
                                           placeholder="Filter by name...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Level</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="2" id="positions-filter-level"
                                           placeholder="Filter by level...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Work Unit</label>
                                    <input type="text" class="form-control filter-input"
                                           data-column="3" id="positions-filter-workunit"
                                           placeholder="Filter by work unit...">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button class="btn btn-secondary btn-sm" onclick="OrganizationManager.clearFilters('positions')">
                                        <i class="bi bi-x-circle"></i> Clear Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-hover" id="positions-table">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Level</th>
                            <th>Work Unit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="positions-body">
                        <tr><td colspan="5" class="text-center text-muted">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div><!-- End Table View -->

<!-- Diagram View -->
<div id="diagram-view" style="display: none;">

<!-- Context Menu for Node Right-Click -->
<div id="org-context-menu" class="org-context-menu" style="display: none;">
    <div class="org-context-menu-item" data-action="view">
        <i class="bi bi-eye"></i> View Details
    </div>
    <div class="org-context-menu-item" data-action="edit">
        <i class="bi bi-pencil"></i> Edit
    </div>
    <div class="org-context-menu-item" data-action="add-child">
        <i class="bi bi-plus-circle"></i> Add Child
    </div>
    <div class="org-context-menu-item" data-action="delete">
        <i class="bi bi-trash"></i> Delete
    </div>
</div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="showTableView()">
                <i class="bi bi-table"></i> Back to Table View
            </button>
        </div>
        <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.zoomIn()" title="Zoom In">
                <i class="bi bi-zoom-in"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.zoomOut()" title="Zoom Out">
                <i class="bi bi-zoom-out"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.resetZoom()" title="Reset View">
                <i class="bi bi-aspect-ratio"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.expandAll()" title="Expand All">
                <i class="bi bi-arrows-expand"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.collapseAll()" title="Collapse All">
                <i class="bi bi-arrows-collapse"></i>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="OrgDiagram.exportPNG()" title="Export to PNG">
                <i class="bi bi-download"></i>
            </button>
        </div>
    </div>

    <!-- Diagram Container -->
    <div id="org-diagram-container" style="width: 100%; height: 700px; border: 1px solid #dee2e6; border-radius: 8px; background-color: #fff; position: relative; overflow: hidden;"></div>

    <!-- Diagram Legend -->
    <div class="card mt-3">
        <div class="card-header d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem; cursor: pointer;" onclick="toggleLegend()">
            <strong><i class="bi bi-list-ul me-2"></i>Legend</strong>
            <i class="bi bi-chevron-up" id="legend-toggle-icon"></i>
        </div>
        <div class="card-body" id="diagram-legend-body" style="padding: 1rem;">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div style="width: 20px; height: 20px; background-color: #667eea; border-radius: 4px; margin-right: 8px;"></div>
                        <span>District</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div style="width: 20px; height: 20px; background-color: #764ba2; border-radius: 4px; margin-right: 8px;"></div>
                        <span>Work Unit</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div style="width: 20px; height: 20px; background-color: #f093fb; border-radius: 4px; margin-right: 8px;"></div>
                        <span>Affair</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div style="width: 20px; height: 20px; background-color: #4facfe; border-radius: 4px; margin-right: 8px;"></div>
                        <span>Position</span>
                    </div>
                </div>
            </div>
            <hr class="my-2">
            <div class="row g-3">
                <div class="col-md-6">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        <strong>Tip:</strong> Double-click nodes to expand/collapse. Drag nodes to reposition.
                    </small>
                </div>
                <div class="col-md-6">
                    <small class="text-muted">
                        <i class="bi bi-mouse me-1"></i>
                        <strong>Controls:</strong> Scroll to zoom, drag to pan, right-click for menu.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div><!-- End Diagram View -->

<!-- Page Modals -->
<div id="page-modals"></div>

<script>
// Initialize organization page
function initializeOrgPage() {
    debugLog('ORG_PAGE', '=== initializeOrgPage START ===');

    // Initialize old OrganizationManager for legacy tabs
    if (typeof OrganizationManager !== 'undefined' && OrganizationManager.init) {
        debugLog('ORG_PAGE', 'Initializing OrganizationManager...');
        OrganizationManager.init();
    } else {
        debugLog('ORG_PAGE', 'OrganizationManager not available');
    }

    // Initialize new OrgUnitManager for BPJS structure
    if (typeof OrgUnitManager !== 'undefined' && OrgUnitManager.init) {
        debugLog('ORG_PAGE', 'Initializing OrgUnitManager...');
        OrgUnitManager.init();
    } else {
        debugLog('ORG_PAGE', 'OrgUnitManager not available');
    }

    debugLog('ORG_PAGE', '=== initializeOrgPage COMPLETE ===');
}

// Try to initialize immediately (in case scripts already loaded)
if (document.readyState === 'loading') {
    // Still loading, wait for DOMContentLoaded
    document.addEventListener('DOMContentLoaded', initializeOrgPage);
} else {
    // DOM already ready, initialize now
    initializeOrgPage();
}

// Also add a fallback initialization in case scripts load late
setTimeout(function() {
    if (typeof OrgUnitManager !== 'undefined' && OrgUnitManager.init) {
        // Check if already initialized by checking for tree container
        const treeContainer = document.getElementById('org-units-tree-container');
        if (treeContainer && !treeContainer.hasAttribute('data-initialized')) {
            debugLog('ORG_PAGE', 'Fallback: Initializing OrgUnitManager...');
            OrgUnitManager.init();
            treeContainer.setAttribute('data-initialized', 'true');
        }
    }
}, 500);
</script>
